## Текущий статус бота

### State
- provider: memory
- ttl: ?
- redis: заготовка, не используется

### GPT
- используется для ответов
- reasoning не выделен

### Intents
- отсутствуют как сущность

### Knowledge
- локальная папка /knowledge
- WordPress нет

### Server
- stage2.final.js — стабильный

# Project Snapshot — Automotive Services Platform

## 1. Что это за продукт

Это единая платформа автомобильных услуг, которая объединяет:
- клиентов (владельцев авто)
- партнёров (СТО, сервисные центры, магазины, страховые и др.)

Платформа предоставляет:
- поиск сервисов по услугам, рейтингу и геолокации
- онлайн-запись в сервисы
- уведомления и подтверждения
- чат-интерфейс для общения и координации
- консультации с использованием AI

Чат-бот является частью системы и служит интерфейсом логики и коммуникации.

---

## 2. Основные роли в системе

### Клиенты
- ищут автомобильные услуги
- выбирают сервисные центры
- записываются на обслуживание
- получают уведомления
- получают консультации через чат

### Партнёры (сервисы)
- получают заявки и записи
- подтверждают или изменяют время
- получают уведомления через систему
- могут использовать платформу как CRM-записи

---

## 3. Роль чат-бота

Чат-бот НЕ является самостоятельным сервисом.

Чат-бот — это:
- интерфейс записи на услуги
- помощник по уточнению деталей заказа
- координатор между клиентом и сервисом
- канал уведомлений
- AI-консультант (ограниченный доступ / подписка)

Чат-бот НЕ:
- хранит данные
- управляет расписаниями
- владеет бизнес-логикой сервиса
- принимает оплату
- знает структуру сайта

---

## 4. Основные сценарии использования чат-бота

### 4.1 Запись в сервис (основной сценарий)
- пользователь нажимает «Записаться» на сайте / в приложении
- открывается чат с заранее переданным контекстом
- бот уточняет дату и время
- получает доступные слоты от backend
- предлагает варианты
- подтверждает запись
- отправляет заявку партнёру
- информирует клиента о статусе

### 4.2 Консультации
- пользователь задаёт вопрос в чате
- получает 1 бесплатный AI-ответ
- дальнейшие консультации доступны по подписке

### 4.3 Экстренные сценарии (дополнительные)
- ДТП
- поломка на дороге

Экстренные сценарии запускаются из интерфейса приложения (через SOS-кнопку)  
и являются вспомогательной функцией платформы.

---

## 5. Архитектура (текущее состояние)

### Backend
- Node.js + Express
- Один основной сервер (`server.js`)
- Webhook-интеграция с Chatwoot

### Чат
- Chatwoot
- Чат используется как UI и канал событий

### AI
- OpenAI (GPT-4o-mini)
- Используется для консультаций и помощи

### State
- In-memory state (подготовлено для Redis)

---

## 6. Структура проекта (актуальная)

```text
/
├── server.js
├── package.json
├── .env
├── PROJECT_SNAPSHOT.md
│
├── state/
│   ├── index.js
│   ├── memory.js
│   └── redis.js
│
├── scenarios/
│   ├── dtp/
│   └── breakdown/
│
├── utils/
│   ├── chatwoot.js
│   └── gpt.js
│
└── _archive/

---

## 10. Принципы использования AI (ОЧЕНЬ ВАЖНО)

### Роль GPT в проекте

GPT в данном проекте НЕ является:
- свободным чат-консультантом
- универсальным помощником
- источником знаний вне платформы

GPT используется строго как вспомогательный инструмент.

### Где GPT РАЗРЕШЁН
- нормализация пользовательского ввода
- исправление орфографии и опечаток
- понимание намерения пользователя
- преобразование человеческого языка в структурированные данные
- 1 ограниченный смысловой ответ в рамках сценария

### Где GPT ЗАПРЕЩЁН
- свободные диалоги
- ответы вне тематики платформы
- консультации без сценария
- предложения услуг, которых нет в системе
- подмена логики сайта

### Источник правды
- структура услуг
- возможность записи
- список партнёров
- бизнес-правила

ВСЕГДА определяется сайтом / приложением.
GPT и чат-бот не принимают решений самостоятельно.

### Принцип экономии
- GPT вызывается минимально
- основной диалог строится на заготовленных сценариях
- AI используется как «подкачка интеллекта», а не как диалоговый движок
